const TelegramBot = require('node-telegram-bot-api');
const express = require('express');

const app = express();
const PORT = process.env.PORT || 3000;
const TOKEN = process.env.BOT_TOKEN || '8403400788:AAEbCN7oZRdQRqLdrmyJ44NL3TtB71i-b74';

const bot = new TelegramBot(TOKEN, {polling: true});

// Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ñ‹ Ð´Ð»Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
const responses = {
    'price': {
        keywords: ['ÑÐºÐ¾Ð»ÑŒÐºÐ¾', 'ÑÑ‚Ð¾Ð¸Ñ‚', 'Ñ†ÐµÐ½Ð°', 'ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ', 'price', 'cost', 'money', 'Ð´ÐµÐ½ÑŒÐ³Ð¸', 'aed', 'Ð´Ð¸Ñ€Ñ…Ð°Ð¼'],
        text: `ðŸ’Ž Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð½Ð°ÑˆÐ¸Ñ… ÑƒÑÐ»ÑƒÐ³:\n\nâ€¢ 1 Ñ‡Ð°Ñ: 1500 AED\nâ€¢ 2 Ñ‡Ð°ÑÐ°: 2500 AED\nâ€¢ ÐÐ¾Ñ‡ÑŒ: 5000 AED\nâ€¢ VIP Ð¿Ð°ÐºÐµÑ‚: Ð¾Ñ‚ 8000 AED\n\nÐ’ÑÐµ Ñ†ÐµÐ½Ñ‹ Ð¾Ð±ÑÑƒÐ¶Ð´Ð°ÑŽÑ‚ÑÑ Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ð¾ Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼.`
    },
    'payment': {
        keywords: ['Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ', 'Ð¾Ð¿Ð»Ð°Ñ‚Ð°', 'ÐºÐ°Ñ€Ñ‚Ð°', 'Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ', 'ÐºÑ€Ð¸Ð¿Ñ‚Ð°', 'Ð±Ð¸Ñ‚ÐºÐ¾Ð¸Ð½', 'payment', 'pay', 'cash', 'card'],
        text: `ðŸ’³ Ð¡Ð¿Ð¾ÑÐ¾Ð±Ñ‹ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹:\n\nâ€¢ ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ AED\nâ€¢ ÐšÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚Ð° (BTC, ETH)\nâ€¢ Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¸Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´\nâ€¢ ÐšÐ°Ñ€Ñ‚Ñ‹ (Ð¿Ð¾ ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð¸ÑŽ)\n\nÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ñ€Ð°ÑÑÐºÐ°Ð¶ÐµÑ‚ Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð°Ñ….`
    },
    'credit': {
        keywords: ['Ð´Ð¾Ð»Ð³', 'Ñ€Ð°ÑÑÑ€Ð¾Ñ‡ÐºÐ°', 'ÐºÑ€ÐµÐ´Ð¸Ñ‚', 'Ð¿Ð¾Ñ‚Ð¾Ð¼', 'Ð¿Ð¾Ð·Ð¶Ðµ', 'Ð·Ð°Ð²Ñ‚Ñ€Ð°', 'credit', 'debt', 'later'],
        text: `ðŸš« Ðš ÑÐ¾Ð¶Ð°Ð»ÐµÐ½Ð¸ÑŽ, Ð¼Ñ‹ Ð½Ðµ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ ÑƒÑÐ»ÑƒÐ³Ð¸ Ð² Ð´Ð¾Ð»Ð³.\n\nÐ’ÑÐµ ÑƒÑÐ»ÑƒÐ³Ð¸ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸ Ð²ÑÑ‚Ñ€ÐµÑ‡Ðµ.\nÐœÑ‹ Ñ†ÐµÐ½Ð¸Ð¼ Ð²Ð°ÑˆÐµ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ðŸ’Ž`
    },
    'philosophy': {
        keywords: ['ÑÐ¼Ñ‹ÑÐ»', 'Ð¶Ð¸Ð·Ð½Ð¸', 'Ñ„Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ', 'Ð·Ð°Ñ‡ÐµÐ¼', 'Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ', 'meaning', 'life', 'philosophy'],
        text: `âœ¨ Ð¡Ð¼Ñ‹ÑÐ» Ð¶Ð¸Ð·Ð½Ð¸ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°ÑÐ»Ð°Ð¶Ð´Ð°Ñ‚ÑŒÑÑ ÐºÐ°Ð¶Ð´Ñ‹Ð¼ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð¼!\n\nÐ Ð¼Ñ‹ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÐ¼ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð²Ð°ÑˆÐ¸ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹ Ð² Ð”ÑƒÐ±Ð°Ðµ Ð½ÐµÐ·Ð°Ð±Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ð¼Ð¸! ðŸŒ´\n\nÐ–ÐµÐ»Ð°ÐµÑ‚Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ ÑÐ¿ÑƒÑ‚Ð½Ð¸Ñ†Ñƒ?`
    },
    'girls': {
        keywords: ['Ð´ÐµÐ²ÑƒÑˆÐºÐ¸', 'Ð¼Ð¾Ð´ÐµÐ»Ð¸', 'ÑÐ¿ÑƒÑ‚Ð½Ð¸Ñ†Ð°', 'Ð´Ð°Ð¼Ñ‹', 'Ð²Ñ‹Ð±Ð¾Ñ€', 'girls', 'models', 'ladies', 'choose'],
        text: `ðŸ‘©â€â¤ï¸â€ðŸ’‹â€ðŸ‘¨ Ð£ Ð½Ð°Ñ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ ÑÐ¿ÑƒÑ‚Ð½Ð¸Ñ† Ð² Ð”ÑƒÐ±Ð°Ðµ!\n\nâ€¢ ÐœÐ¾Ð´ÐµÐ»Ð¸ Ð¸Ð· Ð•Ð²Ñ€Ð¾Ð¿Ñ‹ Ð¸ ÐÐ·Ð¸Ð¸\nâ€¢ VIP ÑÐ¾Ð¿Ñ€Ð¾Ð²Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ\nâ€¢ Ð˜Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´\n\nÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ð¼!`
    },
    'time': {
        keywords: ['Ð²Ñ€ÐµÐ¼Ñ', 'ÐºÐ¾Ð³Ð´Ð°', 'ÑÐµÐ¹Ñ‡Ð°Ñ', 'ÑÐµÐ³Ð¾Ð´Ð½Ñ', 'Ð·Ð°Ð²Ñ‚Ñ€Ð°', 'time', 'now', 'today', 'tomorrow'],
        text: `â° ÐœÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ 24/7!\n\nâ€¢ Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ ÐºÑ€ÑƒÐ³Ð»Ð¾ÑÑƒÑ‚Ð¾Ñ‡Ð½Ð¾\nâ€¢ Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ð¿Ñ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ\nâ€¢ Ð›ÑŽÐ±Ð¾Ð¹ Ñ€Ð°Ð¹Ð¾Ð½ Ð”ÑƒÐ±Ð°Ñ\n\nÐ£Ñ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ñƒ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°.`
    },
    'location': {
        keywords: ['Ð³Ð´Ðµ', 'Ð°Ð´Ñ€ÐµÑ', 'Ð»Ð¾ÐºÐ°Ñ†Ð¸Ñ', 'Ð¾Ñ‚ÐµÐ»ÑŒ', 'Ð¿Ñ€Ð¸ÐµÑ…Ð°Ñ‚ÑŒ', 'location', 'address', 'where', 'hotel'],
        text: `ðŸ“ ÐœÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ð¿Ð¾ Ð²ÑÐµÐ¼Ñƒ Ð”ÑƒÐ±Ð°ÑŽ:\nâ€¢ Downtown\nâ€¢ Marina\nâ€¢ JBR\nâ€¢ ÐŸÐ°Ð»ÑŒÐ¼Ð°\nâ€¢ Ð’ÑÐµ 5* Ð¾Ñ‚ÐµÐ»Ð¸\n\nÐŸÑ€Ð¸ÐµÐ·Ð¶Ð°ÐµÐ¼ Ðº Ð²Ð°Ð¼ Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÐ¼ ÑÐ²Ð¾Ð¸ Ð°Ð¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚Ñ‹.`
    }
};

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… ÑÐ»Ð¾Ð²
function findResponse(text) {
    const lowerText = text.toLowerCase();
    
    for (const [key, response] of Object.entries(responses)) {
        for (const keyword of response.keywords) {
            if (lowerText.includes(keyword)) {
                return response.text;
            }
        }
    }
    
    return null;
}

// ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð°
function getKeyboard() {
    return {
        reply_markup: {
            keyboard: [
                ['ðŸ’° Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚?', 'ðŸ’³ Ð§ÐµÐ¼ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ?'],
                ['â° Ð’Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹', 'ðŸ“ Ð›Ð¾ÐºÐ°Ñ†Ð¸Ñ'],
                ['ðŸ‘© Ð”ÐµÐ²ÑƒÑˆÐºÐ¸', 'â“ Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹']
            ],
            resize_keyboard: true,
            one_time_keyboard: false
        }
    };
}

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const welcomeText = `ðŸ‘‹ Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ! ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ ÑÐºÐ¾Ñ€Ð¾ Ð¿Ð¾Ð´Ð¾Ð¹Ð´Ñ‘Ñ‚, Ð¿Ð¾ÐºÐ° Ñ Ð¼Ð¾Ð³Ñƒ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¾ Ð·Ð°Ð´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹:`;
    
    bot.sendMessage(chatId, welcomeText, getKeyboard());
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text;
    
    if (!text) return;
    
    // Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
    if (text.startsWith('/')) return;
    
    // ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ ÑÐ»Ð¾Ð²Ð°Ð¼
    const foundResponse = findResponse(text);
    
    if (foundResponse) {
        bot.sendMessage(chatId, foundResponse, getKeyboard());
    } else {
        // Ð•ÑÐ»Ð¸ Ð½Ðµ Ð½Ð°ÑˆÐ»Ð¸ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð°, Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¼ÐµÐ½ÑŽ
        const defaultText = `ðŸ¤– Ð¯ Ð½Ðµ ÑÐ¾Ð²ÑÐµÐ¼ Ð¿Ð¾Ð½ÑÐ» Ð²Ð°Ñˆ Ð²Ð¾Ð¿Ñ€Ð¾Ñ. Ð’Ð¾Ñ‚ Ñ‡Ñ‚Ð¾ Ñ Ð¼Ð¾Ð³Ñƒ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ:\n\nÐ’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð½Ð¸Ð¶Ðµ Ð¸Ð»Ð¸ Ð¾Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ â¬‡ï¸`;
        
        bot.sendMessage(chatId, defaultText, getKeyboard());
    }
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸
bot.on('text', (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text;
    
    const buttonHandlers = {
        'ðŸ’° ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚?': responses.price.text,
        'ðŸ’³ Ñ‡ÐµÐ¼ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ?': responses.payment.text,
        'â° Ð²Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹': responses.time.text,
        'ðŸ“ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ñ': responses.location.text,
        'ðŸ‘© Ð´ÐµÐ²ÑƒÑˆÐºÐ¸': responses.girls.text,
        'â“ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹': `ðŸ¤” Ð—Ð°Ð´Ð°Ð¹Ñ‚Ðµ Ð²Ð°Ñˆ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼, Ð¸ Ñ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°ÑŽÑÑŒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ!\n\nÐ˜Ð»Ð¸ Ð´Ð¾Ð¶Ð´Ð¸Ñ‚ÐµÑÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð° Ð´Ð»Ñ ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ð¸.`
    };
    
    if (buttonHandlers[text.toLowerCase()]) {
        bot.sendMessage(chatId, buttonHandlers[text.toLowerCase()], getKeyboard());
    }
});

// Express server
app.use(express.json());
app.get('/', (req, res) => {
    res.json({status: 'Dubai Escort Bot is running!'});
});

app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});

console.log('ðŸ¤– Dubai Escort Bot started...');
